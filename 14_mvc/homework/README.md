# Практическая работа, модуль 14

## Цели практической работы

* Познакомиться с паттерном Model-View-Controller на примере Flask-приложения.
* Научиться добавлять визуальную составляющую на сайт с помощью шаблонов и передавать в них необходимые данные.
* Закрепить навыки работы с формами и библиотекой `wtforms`.
* Освоить базовый синтаксис `jinja2`.

## Что входит в практическую работу

1. Добавление новой книги.
2. Валидация формы.
3. Страница книг автора.
4. Счётчик просмотров книг.

## Задача 1. Добавление новой книги

### Что нужно сделать

В лекции мы подключили endpoint, который показывает форму добавления книги. Исходный код вы можете найти в репозитории.

Сделайте так, чтобы она заработала: пусть отправка формы создаёт новую запись в базе данных.

### Советы и рекомендации

* Объект request из модуля `flask` имеет поле `method`, которое показывает, с каким HTTP-методом обратились к данному
  endpoint:

    ```python
    from flask import request
    
    @app.route('/books/form', methods=['GET', 'POST'])
    def get_books_form():
       if request.method == 'POST':
         ...
    ```

* Параметры формы хранятся в словаре `form` у объекта `request`, где в качестве ключей выступают атрибуты `name`
  у `input` в шаблоне:

    ```
    request.form['input_name']
    ```

### Что оценивается

* Книга добавляется в базу данных.
* После обновления страницы `/books` новая книга отображается в списке.

## Задача 2. Валидация формы

### Что нужно сделать

Форма из предыдущей задачи работает, но данные из неё никак не проверяем.

Подключите библиотеки `wtforms` и `flask_wtf`, которые мы использовали в модуле 4, и с помощью них добавьте валидацию —
поля должны быть заполнены.

### Советы и рекомендации

* `FlaskForm` обрабатывает POST-запрос, запуская заданные валидаторы для полей присланной формы. Поэтому не нужно
  работать с `request.form`.

### Что оценивается

В качестве валидатора используется `InputRequired()`.

## Задача 3. Страница книг автора

### Что нужно сделать

В практике №2 мы добавили endpoint, который принимает на вход имя автора, а возвращает все его книги.

Обновите для него визуальную часть, пусть он тоже использует шаблоны.

### Что оценивается

* HTML-код страницы вынесен в отдельный файл.
* Необходимые переменные передаются в шаблон с помощью именованных параметров в `render_template`.

## Задача 4. Счётчик просмотров книг

### Что нужно сделать

Давайте немного расширим информацию о книгах в нашей базе: хочется знать, какая книга самая популярная.

Добавьте:

* Страницу `/books/id`.<br>
  Здесь будет основная информация о книге с указанным ID.

* Новое поле — счётчик просмотров.<br>
  Оно должно увеличиваться на один каждый раз, когда мы показываем запись о книге на сайте. Количество просмотров должно
  отображаться.

### Что оценивается

* Счётчик просмотров книги увеличивается как при показе её в списке, так и на отдельной странице.
* Счётчик просмотров является отдельным полем в БД у модели книги.
* Информация о просмотрах отображается на страницах `/books` и `books/id`.

## Общие советы и рекомендации

[Синтаксис шаблона jinja2](https://docs-python.ru/packages/modul-jinja2-python/sintaksis-shablona-jinja2/)

## Что оценивается в практической работе

* Используются параметризованные запросы.
* В endpoint с параметрами корректно обрабатываются случаи, когда записи не существуют. Например, когда не найдено книги
  с заданным ID.
* Названия переменных, функций и классов имеют значащие имена.
